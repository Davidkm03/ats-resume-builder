<!doctype html><html lang="es"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Creador de Hoja de Vida ATS con IA</title><style>:root{--bg:#0f172a; --panel:#0b1220; --card:#0c1324; --muted:#94a3b8;--text:#e5e7eb; --accent:#7c3aed; --accent2:#6d28d9; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --border:#1f2937;}*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:linear-gradient(180deg,#0a1222,#0f172a);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}.container{max-width:1200px;margin:0 auto;padding:20px}.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px}.title{font-weight:800;font-size:20px}.badge{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted);font-size:12px}.btn{appearance:none;border:1px solid var(--border);background:#111827;color:#fff;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;transition:.2s;display:inline-flex;gap:8px;align-items:center}.btn:hover{transform:translateY(-1px);border-color:#334155}.btn.primary{background:linear-gradient(90deg,var(--accent2),var(--accent));border:none}.btn.ghost{background:#0b1325}.btn.warn{background:#1f2937;border-color:#374151}.btn:disabled{opacity:.6;cursor:not-allowed}.grid{display:grid;grid-template-columns:280px 1fr;gap:16px}@media(max-width:980px){.grid{grid-template-columns:1fr}}.sidebar{background:linear-gradient(180deg,#0b1220,#0a1020);border:1px solid var(--border);border-radius:16px;padding:12px}.step{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;margin-bottom:6px;border:1px solid transparent;cursor:pointer}.step.active{background:#0f172a;border-color:#223049}.step .idx{width:26px;height:26px;display:grid;place-items:center;border-radius:6px;background:#111827;color:#cbd5e1;font-weight:700}.card{background:linear-gradient(180deg,#0c1221,#0b1325);border:1px solid var(--border);border-radius:16px;padding:16px}h2{font-size:18px;margin:0 0 8px 0;color:#fff}.muted{color:var(--muted);font-size:13px}label{font-size:13px;color:#cbd5e1}input[type="text"], input[type="email"], input[type="tel"], input[type="url"], input[type="month"], textarea{width:100%;background:#0a0f1b;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px}textarea{min-height:120px;resize:vertical}.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}.two{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media(max-width:720px){.two{grid-template-columns:1fr}}.three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}@media(max-width:900px){.three{grid-template-columns:1fr}}.divider{height:1px;background:var(--border);margin:16px 0}.list{display:grid;gap:10px}.chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);padding:6px 10px;border-radius:999px;margin:4px}.chip button{all:unset;cursor:pointer;color:#94a3b8}.mini{font-size:12px;color:#9ca3af}.section-actions{display:flex;gap:8px;justify-content:flex-end}.item{border:1px dashed #233047;border-radius:12px;padding:12px;background:#0b1222}.item h4{margin:0 0 8px 0}.scoreBox{display:flex;align-items:center;gap:14px;border:1px solid var(--border);border-radius:14px;padding:12px;background:#0b1220;margin-bottom:8px}.ring{--val:0;width:60px;height:60px;border-radius:50%;background:conic-gradient(var(--ringColor) calc(var(--val)*1%),#1f2937 0);display:grid;place-items:center;position:relative}.ring::after{content:attr(data-label);position:absolute;inset:8px;background:#0b1220;border-radius:50%;display:grid;place-items:center;font-weight:800;font-size:14px}.pill{padding:4px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;margin:2px;display:inline-block}.kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:12px;border:1px solid var(--border);background:#0a0f1b;border-radius:6px;padding:2px 6px}.foot{font-size:12px;color:#9ca3af}dialog{border:none;border-radius:16px;max-width:560px;width:92%;background:#0b1325;color:var(--text);padding:0;box-shadow:0 20px 80px rgba(0,0,0,.5)}dialog .hd{padding:16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}dialog .ct{padding:16px}.switch{position:relative;width:48px;height:26px;background:#374151;border-radius:999px;border:1px solid #475569;cursor:pointer}.switch i{position:absolute;width:22px;height:22px;border-radius:50%;left:2px;top:1.5px;background:#e5e7eb;transition:.2s}.switch.on{background:#6d28d9} .switch.on i{left:24px;background:#fff}.toast{position:fixed;right:16px;bottom:16px;background:#0b1325;border:1px solid var(--border);border-radius:12px;padding:10px 14px;z-index:50}</style></head><body><div class="container"><div class="topbar"><div class="title">üß≠ Creador de Hoja de Vida (ATS) con IA</div><div class="row"><span class="badge">Wizard ‚Ä¢ 100% Front‚ÄëEnd</span><button class="btn" id="btn-settings">‚öôÔ∏è Configuraci√≥n</button><button class="btn ghost" id="btn-reset">‚Ü∫ Reiniciar</button></div></div><div class="grid"><aside class="sidebar" id="sidebar"></aside><main class="card"><div id="step-content"></div><div class="divider"></div><div class="section-actions"><button class="btn" id="prev">‚Üê Anterior</button><button class="btn primary" id="next">Siguiente ‚Üí</button></div></main></div><div id="toast" class="toast" style="display:none"></div></div><!-- Modal Configuraci√≥n --><dialog id="dlg"><div class="hd"><strong>Configuraci√≥n</strong><button class="btn" onclick="dlg.close()">‚úñ</button></div><div class="ct"><div class="row" style="justify-content:space-between;align-items:center"><div><div style="font-weight:700">Habilitar IA (OpenAI)</div><div class="mini">Si est√° activado, las sugerencias y la revisi√≥n ATS usan tu API Key.</div></div><div class="switch" id="sw-ai"><i></i></div></div><div style="height:12px"></div><label>API Key de OpenAI</label><input type="password" id="api-key" placeholder="sk-‚Ä¶" autocomplete="off" /><div style="height:8px"></div><label>Modelo (p.ej. gpt-4o-mini)</label><input type="text" id="api-model" placeholder="gpt-4o-mini" /><div style="height:12px"></div><div class="foot">Tu clave se guarda en <b>localStorage</b>. Recomendado: usar un proxy (Cloudflare Worker) para ocultarla.</div><div style="height:12px"></div><div class="section-actions"><button class="btn primary" id="btn-save">Guardar</button></div></div></dialog><script>/* ========================= Estado & Utilidades ========================= */const $ = (s,root=document)=>root.querySelector(s);const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));const state = {aiEnabled:false,apiKey:"",apiModel:"gpt-4o-mini",jobDescription:"",contact:{ name:"", email:"", phone:"", location:"", linkedin:"", website:"" },summary:"",experience:[], // {title, company, location, start, end, present, bullets:[]}education:[],  // {degree, institution, start, end}skills:[],     // ["JavaScript", "Excel", ...]projects:[],   // {name, description}certifications:[], // {name, issuer, year}review:null};const steps = [{id:'job', label:'Rol Objetivo', render:renderJob},{id:'contact', label:'Contacto', render:renderContact},{id:'summary', label:'Resumen/Perfil', render:renderSummary},{id:'experience', label:'Experiencia', render:renderExperience},{id:'education', label:'Educaci√≥n', render:renderEducation},{id:'skills', label:'Habilidades', render:renderSkills},{id:'projects', label:'Proyectos & Cert.', render:renderProjects},{id:'review', label:'Revisi√≥n ATS', render:renderReview},{id:'export', label:'Exportar', render:renderExport}];let current=0;function showToast(msg){ const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }function saveLocal(){ localStorage.setItem('ats_builder_v1', JSON.stringify(state)); }function loadLocal(){ try{ const s=localStorage.getItem('ats_builder_v1'); if(s){ Object.assign(state, JSON.parse(s)); } }catch(e){}state.aiEnabled = localStorage.getItem('ats_ai_enabled')==='1';state.apiKey = localStorage.getItem('ats_api_key')||"";state.apiModel = localStorage.getItem('ats_api_model')||state.apiModel;}function colorForScore(s){ if(s>=80) return 'var(--ok)'; if(s>=60) return 'var(--warn)'; return 'var(--bad)'; }function uniq(arr){ return Array.from(new Set(arr.filter(Boolean).map(x=>x.trim()))); }function addSkill(sk){ state.skills=uniq([...state.skills, sk]); saveLocal(); renderSkills(); }function removeSkill(sk){ state.skills=state.skills.filter(x=>x!==sk); saveLocal(); renderSkills(); }/* ========================= Sidebar & Navegaci√≥n ========================= */function renderSidebar(){const el=$('#sidebar');el.innerHTML = steps.map((s,i)=>`<div class="step ${i===current?'active':''}" data-idx="${i}"><div class="idx">${i+1}</div><div>${s.label}</div></div>`).join('');$$('.step', el).forEach(x=>x.addEventListener('click',()=>{ current=parseInt(x.dataset.idx,10); render(); }));}function render(){ renderSidebar(); $('#step-content').innerHTML=''; steps[current].render($('#step-content')); $('#prev').disabled = current===0; $('#next').textContent = current===steps.length-1? 'Finalizar' : 'Siguiente ‚Üí'; saveLocal(); }$('#prev').addEventListener('click', ()=>{ if(current>0){ current--; render(); } });$('#next').addEventListener('click', ()=>{ if(current<steps.length-1){ current++; render(); } else { showToast('¬°Listo! Revisa la pesta√±a Exportar.'); } });/* ========================= Renderers de cada paso ========================= */function renderJob(root){root.innerHTML = `<h2>Rol objetivo / Descripci√≥n del cargo</h2><div class="muted">Pega aqu√≠ la descripci√≥n del cargo o escribe el rol objetivo. La IA usar√° esto para ajustar resumen, bullets y habilidades.</div><div style="height:8px"></div><textarea id="jobdesc" placeholder="Ej.: Buscamos Desarrollador Frontend con experiencia en React, optimizaci√≥n web, accesibilidad y pruebas‚Ä¶">${state.jobDescription||''}</textarea><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="btn-suggest-skills">‚ú® Sugerir habilidades</button></div>`;$('#jobdesc').addEventListener('input', e=>{ state.jobDescription = e.target.value; saveLocal(); });$('#btn-suggest-skills').addEventListener('click', async ()=>{if(!ensureAI()) return; const prompt = `A partir de esta JD, devuelve un JSON con {"skills": [..]} priorizando hard skills y herramientas. JD=\n"""${state.jobDescription.slice(0,6000)}"""`;const out = await callOpenAIJSON(prompt);if(out?.skills?.length){ out.skills.slice(0,30).forEach(addSkill); showToast('Habilidades sugeridas a√±adidas'); }});}function renderContact(root){root.innerHTML = `<h2>Datos de contacto</h2><div class="two"><div><label>Nombre completo</label><input type="text" id="c_name" value="${state.contact.name||''}" placeholder="Tu nombre y apellido"/></div><div><label>Ubicaci√≥n (Ciudad, Pa√≠s)</label><input type="text" id="c_loc" value="${state.contact.location||''}" placeholder="Cali, Colombia"/></div></div><div class="three" style="margin-top:8px"><div><label>Email</label><input type="email" id="c_email" value="${state.contact.email||''}" placeholder="tucorreo@dominio.com"/></div><div><label>Tel√©fono</label><input type="tel" id="c_phone" value="${state.contact.phone||''}" placeholder="+57 300 000 0000"/></div><div><label>LinkedIn (URL)</label><input type="url" id="c_li" value="${state.contact.linkedin||''}" placeholder="https://linkedin.com/in/usuario"/></div></div><div style="margin-top:8px"><label>Sitio web / Portafolio (URL)</label><input type="url" id="c_web" value="${state.contact.website||''}" placeholder="https://miportafolio.com"/></div>`;$('#c_name').addEventListener('input', e=>{ state.contact.name=e.target.value; saveLocal(); });$('#c_loc').addEventListener('input', e=>{ state.contact.location=e.target.value; saveLocal(); });$('#c_email').addEventListener('input', e=>{ state.contact.email=e.target.value; saveLocal(); });$('#c_phone').addEventListener('input', e=>{ state.contact.phone=e.target.value; saveLocal(); });$('#c_li').addEventListener('input', e=>{ state.contact.linkedin=e.target.value; saveLocal(); });$('#c_web').addEventListener('input', e=>{ state.contact.website=e.target.value; saveLocal(); });}function renderSummary(root){root.innerHTML = `<h2>Resumen / Perfil</h2><div class="muted">Escribe 3‚Äì5 l√≠neas con tu propuesta de valor. Puedes pedir a la IA un borrador basado en tu JD y experiencia.</div><div style="height:8px"></div><textarea id="summary">${state.summary||''}</textarea><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="btn-suggest-summary">‚ú® Escribir con IA</button></div>`;$('#summary').addEventListener('input', e=>{ state.summary=e.target.value; saveLocal(); });$('#btn-suggest-summary').addEventListener('click', async ()=>{if(!ensureAI()) return;const prompt = `Genera un resumen de 3‚Äì5 l√≠neas, directo y cuantificado, como texto plano. Contexto: JD=\n"""${state.jobDescription.slice(0,4000)}""". Experiencia (t√≠tulos, empresas, logros si hay):\n${JSON.stringify(state.experience).slice(0,4000)}`;const txt = await callOpenAIText(prompt);if(txt){ state.summary = txt.trim(); saveLocal(); renderSummary(root); showToast('Resumen sugerido listo'); }});}function renderExperience(root){root.innerHTML = `<h2>Experiencia</h2><div class="muted">Agrega cargos con fechas y bullets orientados a logros. Usa <b>mes exacto</b> para un mejor chequeo ATS.</div><div id="exp-list" class="list" style="margin-top:8px"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="add-exp">Ôºã Agregar experiencia</button></div>`;$('#add-exp').addEventListener('click', ()=>{ addExperience(); renderExperience(root); });const list = $('#exp-list');state.experience.forEach((e,idx)=> list.appendChild(expItem(e, idx)) );}function expItem(e, idx){const div = document.createElement('div'); div.className='item';div.innerHTML = `<h4>${e.title||'Sin t√≠tulo'} ‚Äî <span class="mini">${e.company||''}</span></h4><div class="three"><div><label>Cargo</label><input type="text" value="${e.title||''}" data-k="title"></div><div><label>Empresa</label><input type="text" value="${e.company||''}" data-k="company"></div><div><label>Ubicaci√≥n</label><input type="text" value="${e.location||''}" data-k="location"></div></div><div class="three" style="margin-top:8px"><div><label>Inicio</label><input type="month" value="${e.start||''}" data-k="start"></div><div><label>Fin</label><input type="month" value="${e.end||''}" data-k="end" ${e.present?'disabled':''}></div><div style="display:flex;align-items:center;gap:8px; margin-top:22px"><input type="checkbox" id="present_${idx}" ${e.present?'checked':''}> <label for="present_${idx}">Actualmente</label></div></div><div style="margin-top:8px"><label>Bullets (uno por l√≠nea)</label><textarea data-k="bullets">${(e.bullets||[]).join('\n')}</textarea></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" data-act="ai-bullets">‚ú® Bullets con IA</button><button class="btn warn" data-act="remove">üóë Eliminar</button></div>`;// Eventos$$('input,textarea', div).forEach(inp=>{inp.addEventListener('input', ()=>{const k = inp.dataset.k; if(!k) return;if(k==='bullets'){ e.bullets = inp.value.split(/\n+/).map(x=>x.trim()).filter(Boolean); }else { e[k] = inp.type==='checkbox' ? inp.checked : inp.value; }saveLocal();// Refrescar encabezadodiv.querySelector('h4').innerHTML = `${e.title||'Sin t√≠tulo'} ‚Äî <span class="mini">${e.company||''}</span>`;});});const present = div.querySelector(`#present_${idx}`);present.addEventListener('change', ()=>{ e.present = present.checked; saveLocal(); renderExperience($('#step-content')); });div.querySelector('[data-act="remove"]').addEventListener('click', ()=>{ state.experience.splice(idx,1); saveLocal(); renderExperience($('#step-content')); });div.querySelector('[data-act="ai-bullets"]').addEventListener('click', async ()=>{if(!ensureAI()) return;const prompt = `Escribe bullets (m√°x 6) con verbo de acci√≥n, m√©trica y resultado para el rol "${e.title}" en "${e.company}". Devuelve JSON {"bullets":["..."]}. JD: ${state.jobDescription.slice(0,1200)}`;const out = await callOpenAIJSON(prompt);if(out?.bullets?.length){ e.bullets = out.bullets.slice(0,8); saveLocal(); renderExperience($('#step-content')); showToast('Bullets generados'); }});return div;}function addExperience(){ state.experience.push({title:'',company:'',location:'',start:'',end:'',present:false,bullets:[]}); saveLocal(); }function renderEducation(root){root.innerHTML = `<h2>Educaci√≥n</h2><div id="edu-list" class="list" style="margin-top:8px"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="add-edu">Ôºã Agregar estudio</button></div>`;$('#add-edu').addEventListener('click', ()=>{ state.education.push({degree:'',institution:'',start:'',end:''}); saveLocal(); renderEducation(root); });const list = $('#edu-list');state.education.forEach((e,idx)=>{const div=document.createElement('div'); div.className='item';div.innerHTML=`<div class="three"><div><label>T√≠tulo / Programa</label><input type="text" data-k="degree" value="${e.degree||''}"></div><div><label>Instituci√≥n</label><input type="text" data-k="institution" value="${e.institution||''}"></div><div><label>Periodo</label><div class="two"><input type="month" data-k="start" value="${e.start||''}"><input type="month" data-k="end" value="${e.end||''}"></div></div></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn warn" data-act="remove">üóë Eliminar</button></div>`;$$('input',div).forEach(inp=>inp.addEventListener('input',()=>{ e[inp.dataset.k]=inp.value; saveLocal(); }));div.querySelector('[data-act="remove"]').addEventListener('click',()=>{ state.education.splice(idx,1); saveLocal(); renderEducation(root); });list.appendChild(div);});}function renderSkills(root){root.innerHTML = `<h2>Habilidades</h2><div class="muted">Escribe una y presiona Enter. Combina t√©cnicas (hard) y comportamentales (soft) relevantes al cargo.</div><div style="margin-top:8px" class="row"><input type="text" id="skill-inp" placeholder="Ej.: React, An√°lisis de datos, Excel avanzado, Comunicaci√≥n‚Ä¶"/></div><div id="skill-chips" style="margin-top:8px"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="btn-skill-ai">‚ú® Completar con IA</button></div>`;const inp = $('#skill-inp');inp.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); const v=inp.value.trim(); if(v){ addSkill(v); inp.value=''; } } });function renderChips(){ $('#skill-chips').innerHTML = state.skills.map(s=>`<span class="chip">${s}<button title="quitar" data-s="${s}">‚úñ</button></span>`).join('');$$('#skill-chips button').forEach(b=>b.addEventListener('click',()=>removeSkill(b.dataset.s))); }renderChips();$('#btn-skill-ai').addEventListener('click', async ()=>{if(!ensureAI()) return; const prompt = `Devuelve JSON {"skills":["..."]} con habilidades faltantes para este perfil seg√∫n JD y experiencia. JD=\n${state.jobDescription.slice(0,2000)}\nExperiencia=\n${JSON.stringify(state.experience).slice(0,2000)}\nYa tengo=\n${state.skills.join(', ')}`;const out = await callOpenAIJSON(prompt);if(out?.skills?.length){ out.skills.forEach(addSkill); showToast('Habilidades a√±adidas'); }});}function renderProjects(root){root.innerHTML = `<h2>Proyectos & Certificaciones</h2><div class="two"><div class="item" id="proj-box"><h4>Proyectos</h4><div id="proj-list" class="list"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="add-proj">Ôºã Agregar proyecto</button></div></div><div class="item" id="cert-box"><h4>Certificaciones</h4><div id="cert-list" class="list"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="add-cert">Ôºã Agregar certificaci√≥n</button></div></div></div>`;$('#add-proj').addEventListener('click',()=>{ state.projects.push({name:'',description:''}); saveLocal(); renderProjects(root); });$('#add-cert').addEventListener('click',()=>{ state.certifications.push({name:'',issuer:'',year:''}); saveLocal(); renderProjects(root); });const plist = $('#proj-list'), clist = $('#cert-list');state.projects.forEach((p,idx)=>{const div=document.createElement('div'); div.className='item';div.innerHTML=`<div class="two"><input type="text" placeholder="Nombre del proyecto" data-k="name" value="${p.name||''}"><input type="text" placeholder="Descripci√≥n breve (impacto)" data-k="description" value="${p.description||''}"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn warn" data-act="remove">üóë</button></div>`;$$('input',div).forEach(inp=>inp.addEventListener('input',()=>{ p[inp.dataset.k]=inp.value; saveLocal(); }));div.querySelector('[data-act="remove"]').addEventListener('click',()=>{ state.projects.splice(idx,1); saveLocal(); renderProjects(root); });plist.appendChild(div);});state.certifications.forEach((c,idx)=>{const div=document.createElement('div'); div.className='item';div.innerHTML=`<div class="three"><input type="text" placeholder="Nombre" data-k="name" value="${c.name||''}"><input type="text" placeholder="Entidad" data-k="issuer" value="${c.issuer||''}"><input type="text" placeholder="A√±o" data-k="year" value="${c.year||''}"></div><div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn warn" data-act="remove">üóë</button></div>`;$$('input',div).forEach(inp=>inp.addEventListener('input',()=>{ c[inp.dataset.k]=inp.value; saveLocal(); }));div.querySelector('[data-act="remove"]').addEventListener('click',()=>{ state.certifications.splice(idx,1); saveLocal(); renderProjects(root); });clist.appendChild(div);});}function renderReview(root){const r = computeATSScore();root.innerHTML = `<h2>Revisi√≥n ATS</h2><div class="scoreBox"><div class="ring" id="ring" data-label="${r.score}" style="--val:${r.score}; --ringColor:${colorForScore(r.score)}"></div><div><div style="font-weight:800">Puntaje estimado: ${r.score}/100</div><div class="mini">Basado en contacto, secciones, longitud, bullets, fechas y palabras clave (JD).</div></div></div><div class="divider"></div><div id="kw"></div><div class="divider"></div><div id="checks"></div><div class="divider"></div><div id="advice"></div><div class="section-actions"><button class="btn" id="btn-ai-review">ü§ñ Revisi√≥n con IA</button></div>`;// Palabras claveconst km = r.keywordMatch;$('#kw').innerHTML = state.jobDescription? `<div class="mini">Coincidencia JD: <b>${km.hits.length}/${km.total}</b> (${Math.round(km.ratio*100)}%)</div><div style="margin-top:8px">${r.jobKeywords.map(k=>`<span class="pill" style="border-color:${km.hits.includes(k)?'#10b981':'#334155'}">${km.hits.includes(k)?'‚úîÔ∏é ':''}${k}</span>`).join('')}</div>` : '<div class="mini">No hay JD. A√±√°dela en el paso 1.</div>';// Chequeosconst rows = [['Contacto', r.emails.length&&r.phones.length, (r.emails.length? 'Email ‚úîÔ∏é':'Falta email') + ' ¬∑ ' + (r.phones.length? 'Tel√©fono ‚úîÔ∏é':'Falta tel√©fono') + (r.linkedIn? ' ¬∑ LinkedIn ‚úîÔ∏é':' ¬∑ LinkedIn opcional')],['Secciones', r.sectionCount>=4, `Detectadas: ${Object.entries(r.sections).filter(([k,v])=>v).map(([k])=>k).join(', ')||'‚Äî'}`],['Longitud', r.wc>80 && r.wc<=1200, `Palabras: ${r.wc}`],['Bullets', r.bullets.ratio>=0.15 && r.bullets.ratio<=0.5, `Bullets: ${r.bullets.bullets} (${Math.round(r.bullets.ratio*100)}%)`],['Fechas', r.spans.length>=1, `Rangos detectados: ${r.spans.length}`],['Tablas/columnas', !r.tables, r.tables? 'Probablemente presentes':'No detectadas']];$('#checks').innerHTML = rows.map(([n,ok,desc])=>`<div class="row" style="justify-content:space-between;border:1px solid var(--border);padding:10px;border-radius:12px;background:#0b1220;margin:6px 0"><div><b>${n}</b><div class="mini">${desc}</div></div><div class="pill" style="border-color:${ok?'#10b981':'#f87171'}">${ok?'OK':'Revisar'}</div></div>`).join('');// Consejos nativos$('#advice').innerHTML = r.advice.length? r.advice.map(a=>`<div class="row" style="gap:8px"><span class="pill" style="border-color:#f59e0b">Tip</span><div>${a}</div></div>`).join('') : '<div class="mini">Sin consejos cr√≠ticos.</div>';$('#btn-ai-review').addEventListener('click', async ()=>{if(!ensureAI()) return;const payload = {resumen: state.summary,contact: state.contact,experience: state.experience,education: state.education,skills: state.skills,projects: state.projects,certifications: state.certifications,jd: state.jobDescription};const prompt = `Eres experto ATS. Valida este CV y devuelve SOLO JSON con claves: {"riesgos_ats":[],"mejoras_prioritarias":[],"palabras_clave_faltantes":[],"perfil_sugerido":"...","bullets_mejorados":{"IDX":"- bullet"}}. Datos=\n${JSON.stringify(payload).slice(0,25000)}`;const out = await callOpenAIJSON(prompt);const adv = $('#advice');adv.insertAdjacentHTML('beforeend','<div class="divider"></div>');if(out?.perfil_sugerido){ adv.insertAdjacentHTML('beforeend',`<div class="row" style="gap:8px"><span class="pill" style="border-color:#10b981">Perfil sugerido</span><div>${out.perfil_sugerido}</div></div>`); }if(out?.riesgos_ats?.length){ adv.insertAdjacentHTML('beforeend',`<div class="row" style="gap:8px"><span class="pill" style="border-color:#ef4444">Riesgos</span><div>${out.riesgos_ats.join('; ')}</div></div>`); }if(out?.mejoras_prioritarias?.length){ adv.insertAdjacentHTML('beforeend',`<div class="row" style="gap:8px"><span class="pill" style="border-color:#f59e0b">Prioriza</span><div>${out.mejoras_prioritarias.join('; ')}</div></div>`); }if(out?.palabras_clave_faltantes?.length){ adv.insertAdjacentHTML('beforeend',`<div class="row" style="gap:8px"><span class="pill" style="border-color:#64748b">Keywords</span><div>${out.palabras_clave_faltantes.join(', ')}</div></div>`); }if(out?.bullets_mejorados){ adv.insertAdjacentHTML('beforeend',`<div class="row" style="gap:8px"><span class="pill" style="border-color:#22c55e">Bullets+</span><div><pre class="mini" style="white-space:pre-wrap">${JSON.stringify(out.bullets_mejorados,null,2)}</pre></div></div>`); }showToast('Revisi√≥n IA agregada');});}function renderExport(root){const txt = buildATSText();const html = buildATSHTML();root.innerHTML = `<h2>Exportar</h2><div class="muted">Generamos una versi√≥n en texto plano (ideal para ATS) y una vista HTML imprimible. Puedes descargar JSON de tu CV.</div><div class="divider"></div><div class="row" style="justify-content:flex-end"><button class="btn warn" id="btn-download-json">‚¨áÔ∏è JSON</button><button class="btn" id="btn-copy">üìã Copiar TXT</button><button class="btn" id="btn-download-txt">‚¨áÔ∏è Descargar TXT</button><button class="btn primary" id="btn-print">üñ®Ô∏è Imprimir / PDF</button></div><div class="divider"></div><h3 style="margin:0 0 6px 0">Vista previa (HTML)</h3><div id="preview" class="item" style="background:#0b1220">${html}</div><div class="divider"></div><h3 style="margin:0 0 6px 0">Texto plano (ATS)</h3><pre id="txtpre" style="white-space:pre-wrap;background:#0a0f1b;border:1px solid var(--border);padding:12px;border-radius:12px;max-height:360px;overflow:auto">${txt}</pre>`;$('#btn-copy').addEventListener('click', async ()=>{ await navigator.clipboard.writeText(txt); showToast('TXT copiado'); });$('#btn-download-txt').addEventListener('click', ()=>{ const b=new Blob([txt],{type:'text/plain'}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download= sanitizeFile(`${state.contact.name||'cv'}_ATS.txt`); a.click(); URL.revokeObjectURL(u); });$('#btn-print').addEventListener('click', ()=>{ const w=window.open('','_blank'); w.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>CV</title><style>body{font-family:Arial,Helvetica,sans-serif;line-height:1.35;padding:24px} h1{font-size:20px;margin:0 0 4px 0} h2{font-size:16px;margin:16px 0 6px 0} ul{margin:4px 0 12px 18px} .hdr{display:flex;justify-content:space-between;border-bottom:1px solid #ccc;padding-bottom:8px;margin-bottom:8px} .meta{font-size:12px;color:#333} .sec{margin-top:10px}</style></head><body>${html}</body></html>`); w.document.close(); w.focus(); w.print(); });$('#btn-download-json').addEventListener('click', ()=>{ const b=new Blob([JSON.stringify(state,null,2)],{type:'application/json'}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download=sanitizeFile(`${state.contact.name||'cv'}_data.json`); a.click(); URL.revokeObjectURL(u); });}/* ========================= Scoring & Builders ========================= */function computeATSScore(){const resumeText = buildATSText();const wc = resumeText.trim().split(/\s+/).filter(Boolean).length;const emails = (state.contact.email? [state.contact.email]: []).filter(Boolean);const phones = (state.contact.phone? [state.contact.phone]: []).filter(Boolean);const linkedIn = /linkedin\.com\/in\//i.test(state.contact.linkedin||'');const bulletsCount = state.experience.reduce((a,e)=>a+(e.bullets?.length||0),0);const linesCount = bulletsCount + (state.summary? state.summary.split(/\n/).length: 0) + state.experience.length*2 + state.education.length*2 + 10;const bullets = {bullets: bulletsCount, ratio: linesCount? bulletsCount/linesCount:0};const tables=false; // nuestro output es linealconst sections={ resumen: !!state.summary, experiencia: state.experience.length>0, educacion: state.education.length>0, habilidades: state.skills.length>0, certificaciones: state.certifications.length>0, proyectos: state.projects.length>0, idiomas:false };const spans = state.experience.filter(e=>e.start && (e.end || e.present));let score=0;score += Math.min(15, (emails.length?7:0)+(phones.length?5:0)+(linkedIn?3:0));const secCount = ['resumen','experiencia','educacion','habilidades'].filter(k=>sections[k]).length + (sections.certificaciones?1:0);score += Math.min(20, secCount*5);if (wc>80 && wc<=1200){ score += 10; } else if (wc>60 && wc<=1600){ score += 6; }if (bullets.ratio>=0.15 && bullets.ratio<=0.5) score += 10; else if (bullets.ratio>0.05) score += 6;if (tables) score -= 10;if (spans.length>=2) score += 8; else if (spans.length>=1) score += 5;// Keywords (si hay JD)const jobKeywords = keywordsFromJD(state.jobDescription||'');const kwMatch = matchKeywords(resumeText.toLowerCase(), jobKeywords);if (state.jobDescription){const r = kwMatch.ratio; if (r>=0.6) score += 25; else if (r>=0.4) score += 18; else if (r>=0.25) score += 10; else if (r>0.1) score += 5;}score += Math.min(5, (state.contact.website?3:0) + (linkedIn?2:0));score = Math.max(0, Math.min(100, Math.round(score)));const advice=[];if(!emails.length) advice.push('Agrega un correo profesional visible.');if(!phones.length) advice.push('Incluye un n√∫mero de tel√©fono con indicativo.');if(!linkedIn) advice.push('A√±ade tu enlace de LinkedIn (linkedin.com/in/usuario).');if(!sections.resumen) advice.push('Redacta un resumen de 3‚Äì5 l√≠neas con m√©trica de impacto.');if(!sections.experiencia) advice.push('A√±ade experiencia con logros cuantificados.');if(!sections.educacion) advice.push('Incluye tu formaci√≥n acad√©mica.');if(!sections.habilidades) advice.push('Incluye un bloque de habilidades relevantes.');if(wc>1200) advice.push('Reduce a 1‚Äì2 p√°ginas (‚â§1200 palabras).');if(wc<150) advice.push('Ampl√≠a el contenido; est√° muy breve.');if(bullets.ratio<0.15) advice.push('Usa bullets en al menos 30% de las l√≠neas.');if(bullets.ratio>0.5) advice.push('Reduce la densidad de bullets; prioriza impactos clave.');if(state.jobDescription && kwMatch.ratio<0.5) advice.push('Integra palabras clave espec√≠ficas del cargo de forma natural.');return {score,wc,emails,phones,linkedIn,bullets,tables,sections,spans,jobKeywords,keywordMatch:kwMatch,advice,sectionCount:secCount};}function buildATSText(){const L=[]; const c=state.contact;if(c.name) L.push(c.name.toUpperCase());const meta=[c.location, c.email, c.phone, c.linkedin, c.website].filter(Boolean).join(' | ');if(meta) L.push(meta);L.push('');if(state.summary){ L.push('RESUMEN', state.summary.trim(), ''); }if(state.skills.length){ L.push('HABILIDADES', state.skills.join(', '), ''); }if(state.experience.length){ L.push('EXPERIENCIA'); state.experience.forEach(e=>{ const dates = e.present? `${e.start} ‚Äì Presente` : `${e.start} ‚Äì ${e.end}`; L.push(`${e.title||''} ‚Äî ${e.company||''} ‚Äî ${e.location||''} | ${dates}`); (e.bullets||[]).forEach(b=>L.push(`- ${b}`)); L.push(''); }); }if(state.education.length){ L.push('EDUCACI√ìN'); state.education.forEach(ed=>{ L.push(`${ed.degree||''} ‚Äî ${ed.institution||''} (${ed.start||''} ‚Äì ${ed.end||''})`); }); L.push(''); }if(state.projects.length){ L.push('PROYECTOS'); state.projects.forEach(p=>{ L.push(`${p.name||''}: ${p.description||''}`); }); L.push(''); }if(state.certifications.length){ L.push('CERTIFICACIONES'); state.certifications.forEach(c=>{ L.push(`${c.name||''} ‚Äî ${c.issuer||''} ${c.year||''}`); }); L.push(''); }return L.join('\n').trim()+"\n";}function buildATSHTML(){const c=state.contact;function esc(s){ return (s||'').replace(/[&<>]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])); }const header = `<div class="hdr"><div><h1>${esc(c.name||'')}</h1><div class="meta">${[c.location,c.email,c.phone].filter(Boolean).map(esc).join(' ¬∑ ')}</div></div><div class="meta">${[c.linkedin,c.website].filter(Boolean).map(esc).join('<br>')}</div></div>`;const blocks=[];if(state.summary){ blocks.push(`<div class="sec"><h2>Resumen</h2><div>${esc(state.summary)}</div></div>`); }if(state.skills.length){ blocks.push(`<div class="sec"><h2>Habilidades</h2><div>${state.skills.map(esc).join(', ')}</div></div>`); }if(state.experience.length){ blocks.push(`<div class="sec"><h2>Experiencia</h2>`+ state.experience.map(e=>`<div><strong>${esc(e.title)}</strong> ‚Äî ${esc(e.company)} ‚Äî ${esc(e.location)} <span class="meta">${esc(e.present?`${e.start} ‚Äì Presente`:`${e.start} ‚Äì ${e.end}`)}</span><ul>${(e.bullets||[]).map(b=>`<li>${esc(b)}</li>`).join('')}</ul></div>`).join('') + `</div>`); }if(state.education.length){ blocks.push(`<div class="sec"><h2>Educaci√≥n</h2>`+ state.education.map(ed=>`<div>${esc(ed.degree)} ‚Äî ${esc(ed.institution)} <span class="meta">(${esc(ed.start)} ‚Äì ${esc(ed.end)})</span></div>`).join('') + `</div>`); }if(state.projects.length){ blocks.push(`<div class="sec"><h2>Proyectos</h2>`+ state.projects.map(p=>`<div><strong>${esc(p.name)}</strong>: ${esc(p.description)}</div>`).join('') + `</div>`); }if(state.certifications.length){ blocks.push(`<div class="sec"><h2>Certificaciones</h2>`+ state.certifications.map(c=>`<div>${esc(c.name)} ‚Äî ${esc(c.issuer)} ${esc(c.year)}</div>`).join('') + `</div>`); }return header + blocks.join('');}function sanitizeFile(s){ return s.replace(/[^a-z0-9_\-]+/gi,'_'); }/* ========================= Palabras clave (JD) ========================= */function keywordsFromJD(jd){ jd=(jd||'').toLowerCase(); const tokens=(jd.match(/\b[^\d\W]{3,}\b/g)||[]).filter(w=>!new Set(['los','las','del','para','con','una','unos','unas','que','por','the','and','you','your','de','la','el','en','un','y','o']).has(w)); const freq={}; tokens.forEach(w=>freq[w]=(freq[w]||0)+1); return Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,40).map(x=>x[0]); }function matchKeywords(text, kws){ const hits=kws.filter(k=>new RegExp(`\\b${escapeRegExp(k)}\\b`,'i').test(text)); return {hits,total:kws.length,ratio:kws.length? hits.length/kws.length:0}; }function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); }/* ========================= OpenAI Helpers ========================= */function ensureAI(){ if(!state.aiEnabled){ alert('Activa la IA en Configuraci√≥n.'); return false;} if(!state.apiKey){ alert('Ingresa tu API Key en Configuraci√≥n.'); return false;} return true; }function loadConfigUI(){ $('#sw-ai').classList.toggle('on', state.aiEnabled); $('#api-key').value=state.apiKey; $('#api-model').value=state.apiModel; }async function callOpenAIJSON(user){const payload={ model: state.apiModel||'gpt-4o-mini', messages:[ {role:'system', content:'Responde SOLO JSON v√°lido.'}, {role:'user', content:user} ], response_format:{type:'json_object'}, temperature:0.2, max_tokens:800 };const r = await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+state.apiKey},body:JSON.stringify(payload)});if(!r.ok){ const t=await r.text(); alert('Error OpenAI: '+t); return null; }const data=await r.json(); const text=(data.choices?.[0]?.message?.content||'').trim();try{ return JSON.parse(text); }catch(e){ const m=text.match(/\{[\s\S]*\}/); if(m){ try{ return JSON.parse(m[0]); }catch(e2){ return null; } } return null; }}async function callOpenAIText(user){const payload={ model: state.apiModel||'gpt-4o-mini', messages:[ {role:'system', content:'Escribe en espa√±ol neutro, conciso y profesional.'}, {role:'user', content:user} ], temperature:0.4, max_tokens:600 };const r = await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+state.apiKey},body:JSON.stringify(payload)});if(!r.ok){ const t=await r.text(); alert('Error OpenAI: '+t); return null; }const data=await r.json(); return (data.choices?.[0]?.message?.content||'').trim();}/* ========================= Config & Boot ========================= */const dlg=$('#dlg');$('#btn-settings').addEventListener('click', ()=>{ loadConfigUI(); dlg.showModal(); });$('#sw-ai').addEventListener('click', ()=>{ state.aiEnabled=!state.aiEnabled; localStorage.setItem('ats_ai_enabled', state.aiEnabled?'1':'0'); $('#sw-ai').classList.toggle('on', state.aiEnabled); });$('#btn-save').addEventListener('click', ()=>{ state.apiKey=$('#api-key').value.trim(); state.apiModel=$('#api-model').value.trim()||'gpt-4o-mini'; localStorage.setItem('ats_api_key', state.apiKey); localStorage.setItem('ats_api_model', state.apiModel); dlg.close(); showToast('Configuraci√≥n guardada'); });$('#btn-reset').addEventListener('click', ()=>{ if(confirm('Esto borrar√° el progreso guardado. ¬øContinuar?')){ localStorage.removeItem('ats_builder_v1'); location.reload(); } });loadLocal(); render();</script></body></html>