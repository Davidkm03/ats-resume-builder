# CV Sharing and Duplication Features

This document describes the advanced CV sharing and duplication features implemented in the ATS Resume Builder application.

## CV Sharing Features

### Overview

The CV sharing system allows users to create public, shareable links to their CVs with advanced privacy controls and customization options.

### Basic Sharing

```typescript
import { generateShareURL, sanitizeCVForSharing } from '@/lib/cv';

// Generate a share token and URL
const shareToken = generateShareToken();
const shareUrl = generateShareURL(shareToken);

// Sanitize CV data for public sharing
const sanitizedCV = sanitizeCVForSharing(cvData);
```

### Advanced Sharing Configuration

```typescript
import { ShareConfig, sanitizeCVForSharing } from '@/lib/cv';

const shareConfig: ShareConfig = {
  includeContactInfo: true,
  includePersonalProjects: false,
  includeVolunteerWork: false,
  includeCustomSections: true,
  watermark: 'Generated by ATS Resume Builder',
};

const sanitizedCV = sanitizeCVForSharing(cvData, shareConfig);
```

### Share Permissions and Access Control

```typescript
import { SharePermission, ShareSettings, validateShareAccess } from '@/lib/cv';

const shareSettings: ShareSettings = {
  permissions: [SharePermission.VIEW_ONLY, SharePermission.DOWNLOAD_PDF],
  config: shareConfig,
  expiration: {
    expiresAt: new Date('2024-12-31'),
    maxViews: 100,
    currentViews: 0,
  },
  password: 'optional-password',
  allowedDomains: ['company.com', 'partner.org'],
};

// Validate access request
const accessRequest = {
  permission: SharePermission.VIEW_ONLY,
  domain: 'user@company.com',
  password: 'optional-password',
};

const accessResult = validateShareAccess(shareSettings, accessRequest);
if (accessResult.allowed) {
  // Grant access
} else {
  console.log('Access denied:', accessResult.reason);
}
```

### Time-Limited Sharing

```typescript
import { generateTimeLimitedShareToken } from '@/lib/cv';

// Generate a token that expires in 24 hours
const { token, expiresAt } = generateTimeLimitedShareToken(24);
```

### Share Analytics

```typescript
import { trackShareView, ShareAnalytics } from '@/lib/cv';

// Track when someone views a shared CV
trackShareView('share-token-123', {
  ip: '192.168.1.1',
  userAgent: 'Mozilla/5.0...',
  referrer: 'https://linkedin.com',
  location: 'New York, NY',
});
```

### Social Media Metadata

```typescript
import { generateShareMetadata } from '@/lib/cv';

const metadata = generateShareMetadata(cv, shareUrl);
// Returns: { title, description, url, imageUrl? }
```

## CV Duplication Features

### Overview

The CV duplication system provides flexible options for creating copies of CVs with various levels of customization and data filtering.

### Basic Duplication

```typescript
import { duplicateCVData } from '@/lib/cv';

const duplicatedCV = duplicateCVData(originalCV, 'Copy of My Resume');
```

### Duplication Strategies

```typescript
import { DuplicationStrategy, getDuplicationOptionsForStrategy, duplicateCVData } from '@/lib/cv';

// Available strategies
const strategies = [
  DuplicationStrategy.EXACT_COPY,      // Complete copy with all data
  DuplicationStrategy.TEMPLATE_ONLY,   // Structure only, no personal data
  DuplicationStrategy.ANONYMIZED,      // Anonymized version for sharing
  DuplicationStrategy.CLEAN_SLATE,     // Fresh start with basic structure
  DuplicationStrategy.ROLE_SPECIFIC,   // Optimized for specific roles
];

// Use a strategy
const options = getDuplicationOptionsForStrategy(DuplicationStrategy.ANONYMIZED);
const anonymizedCV = duplicateCVData(originalCV, 'Anonymous Resume', options);
```

### Custom Duplication Options

```typescript
import { DuplicationOptions, duplicateCVData } from '@/lib/cv';

const customOptions: DuplicationOptions = {
  includeSensitiveData: false,        // Remove email, phone, etc.
  includePersonalProjects: true,      // Keep personal projects
  includeVolunteerWork: false,        // Remove volunteer work
  includeCustomSections: true,        // Keep custom sections
  resetDates: true,                   // Clear all dates
  anonymize: false,                   // Don't anonymize names
  templateOverride: 'professional',   // Change template
};

const customCV = duplicateCVData(originalCV, 'Custom Copy', customOptions);
```

### Role-Specific Duplication

```typescript
import { duplicateForRole, RoleBasedDuplicationConfig } from '@/lib/cv';

const roleConfig: RoleBasedDuplicationConfig = {
  targetRole: 'Frontend Developer',
  targetIndustry: 'Technology',
  emphasizeSkills: ['React', 'JavaScript', 'CSS'],
  deemphasizeSkills: ['Backend', 'Database'],
  includeProjects: true,
  includeVolunteerWork: false,
  maxExperienceYears: 5,
};

const frontendCV = duplicateForRole(originalCV, 'Frontend Resume', roleConfig);
```

### Bulk Duplication

```typescript
import { bulkDuplicateCV, BulkDuplicationRequest } from '@/lib/cv';

const bulkRequest: BulkDuplicationRequest = {
  baseCV: originalCV,
  variations: [
    {
      name: 'Software Engineer Resume',
      strategy: DuplicationStrategy.ROLE_SPECIFIC,
      templateOverride: 'modern',
    },
    {
      name: 'Anonymous Template',
      strategy: DuplicationStrategy.ANONYMIZED,
      customOptions: { watermark: 'Template by ATS Builder' },
    },
    {
      name: 'Clean Template',
      strategy: DuplicationStrategy.TEMPLATE_ONLY,
      templateOverride: 'minimal',
    },
  ],
};

const variations = bulkDuplicateCV(bulkRequest);
```

### Duplication Validation

```typescript
import { validateDuplication, generateDuplicationSummary } from '@/lib/cv';

// Validate the duplication result
const validation = validateDuplication(originalCV, duplicatedCV, options);
if (!validation.isValid) {
  console.log('Errors:', validation.errors);
}
if (validation.warnings.length > 0) {
  console.log('Warnings:', validation.warnings);
}

// Generate a summary of what was changed
const summary = generateDuplicationSummary(originalCV, duplicatedCV, options);
console.log('Summary:', {
  originalSections: summary.originalSections,
  duplicatedSections: summary.duplicatedSections,
  preserved: summary.preservedData,
  modified: summary.modifiedData,
  removed: summary.removedData,
});
```

## API Integration

### Sharing Endpoints

```bash
# Generate share link
POST /api/cvs/{id}/share
Response: { shareToken, shareUrl, cv, message }

# Remove share link
DELETE /api/cvs/{id}/share
Response: { cv, message }

# View shared CV (public)
GET /api/cvs/shared/{token}
Response: { cv }
```

### Duplication Endpoints

```bash
# Duplicate CV
POST /api/cvs/{id}/duplicate
Body: { name, description? }
Response: { cv, message }
```

## Use Cases

### 1. Job Application Sharing

```typescript
// Create a professional share link for job applications
const shareConfig = {
  includeContactInfo: true,
  includePersonalProjects: true,
  includeVolunteerWork: false,
  includeCustomSections: false,
  watermark: 'Professional Resume',
};

const professionalCV = sanitizeCVForSharing(cv, shareConfig);
const shareUrl = generateShareURL(generateShareToken());
```

### 2. Template Creation

```typescript
// Create a clean template from an existing CV
const templateOptions = getDuplicationOptionsForStrategy(DuplicationStrategy.TEMPLATE_ONLY);
const template = duplicateCVData(cv, 'Professional Template', templateOptions);
```

### 3. Role-Specific Versions

```typescript
// Create multiple versions for different job applications
const roles = [
  { name: 'Frontend Developer', skills: ['React', 'Vue', 'CSS'] },
  { name: 'Full Stack Developer', skills: ['Node.js', 'React', 'MongoDB'] },
  { name: 'UI/UX Developer', skills: ['Figma', 'CSS', 'JavaScript'] },
];

const roleVersions = roles.map(role => 
  duplicateForRole(originalCV, `${role.name} Resume`, {
    targetRole: role.name,
    emphasizeSkills: role.skills,
    deemphasizeSkills: [],
    includeProjects: true,
    includeVolunteerWork: false,
  })
);
```

### 4. Secure Sharing with Expiration

```typescript
// Create a time-limited share for a specific company
const { token, expiresAt } = generateTimeLimitedShareToken(72); // 3 days

const shareSettings: ShareSettings = {
  permissions: [SharePermission.VIEW_ONLY],
  config: { includeContactInfo: true, includePersonalProjects: true },
  expiration: { expiresAt, currentViews: 0, maxViews: 50 },
  allowedDomains: ['targetcompany.com'],
};
```

## Security Considerations

### Data Sanitization

- Personal information is automatically sanitized based on share configuration
- Sensitive metadata (ATS scores, keywords) is removed from shared versions
- Custom watermarks can be added to identify the source

### Access Control

- Domain-based restrictions limit access to specific organizations
- Password protection adds an extra security layer
- Time-based and view-count expiration prevents indefinite access
- Permission levels control what actions viewers can perform

### Privacy Protection

- Anonymization options protect user identity
- Selective section inclusion allows fine-grained privacy control
- Share analytics track access without storing personal information

## Best Practices

### For Sharing

1. **Use appropriate share configurations** for different contexts (job applications vs. networking)
2. **Set expiration dates** for time-sensitive shares
3. **Monitor share analytics** to understand engagement
4. **Use domain restrictions** when sharing with specific organizations
5. **Add watermarks** to identify the source and maintain branding

### For Duplication

1. **Use role-specific duplication** to optimize CVs for different positions
2. **Validate duplications** to ensure data integrity
3. **Generate summaries** to understand what was changed
4. **Use bulk duplication** for creating multiple variations efficiently
5. **Apply appropriate strategies** based on the intended use case

## Error Handling

Both sharing and duplication features include comprehensive error handling:

- **Validation errors** for invalid data or configurations
- **Access denied errors** for unauthorized share access
- **Expiration errors** for expired share links
- **Data integrity errors** for corrupted duplication results

All errors include descriptive messages and suggested remediation steps.